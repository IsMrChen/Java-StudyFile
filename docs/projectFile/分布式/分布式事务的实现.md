## 一、分布式事务的实现模式

- 消息驱动模式

- 事件溯源模式：Event Sourcing

- TCC模式：Try-Confirm-Cancel，适用于服务间调用场景

## 二、分布式事务的幂等性

**幂等性**

幂等性操作：任意多次执行所产生的影响，与一次执行的影响相同

方法的幂等性：使用同样的参数调用一个方法多次，与调用一次结果相同

接口的幂等性：接口被重复调用，结果一致

**微服务接口的幂等性**

重要性：经常需要通过重试实现分布式事务的最终一致性

GET方法不会对系统产生副作用、具有幂等性

POST、PUT、DELETE方法的实现需要满足幂等性

**SQL实现幂等性**

![1](img\1.png)

### 三、消息驱动模式

![2](img\2.png)

**系统错误处理**

- 方法一：将出错未处理的消息写到失败队列，进行相应的回滚操作
- 方法二：通过定时任务检查超时订单，对未完成的订单做自动回滚
- 方法三：保存出错信息，人工处理

#### 3.1分布式事务实例

**设计**

![3](img\3.png)

![4](img\4.png)

![5](img\5.png)

实现锁票的安全性

- 利用@JmsListener设置一个消费者，不适用于多实例
- 使用事务和数据库锁的特性
- 分布式锁

参考文章：[https://zhuanlan.zhihu.com/p/41325399](https://zhuanlan.zhihu.com/p/41325399)